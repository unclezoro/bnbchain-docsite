"use strict";(self.webpackChunkbeta_BNB_Docs=self.webpackChunkbeta_BNB_Docs||[]).push([[3990],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>p});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),l=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=l(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),d=l(a),m=r,p=d["".concat(s,".").concat(m)]||d[m]||h[m]||o;return a?n.createElement(p,i(i({ref:t},u),{},{components:a})):n.createElement(p,i({ref:t},u))}));function p(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c[d]="string"==typeof e?e:r,i[1]=c;for(var l=2;l<o;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},54045:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var n=a(87462),r=(a(67294),a(3905));const o={sidebar_label:"Architecture",sidebar_position:2,hide_table_of_contents:!1},i="Cross-Chain Communication",c={unversionedId:"learn/cross-chain",id:"learn/cross-chain",title:"Cross-Chain Communication",description:"Cross-chain communication is the key foundation to allow the community to take advantage of the dual chain structure:",source:"@site/docs/learn/cross-chain.md",sourceDirName:"learn",slug:"/learn/cross-chain",permalink:"/bnbchain-docsite/docs/learn/cross-chain",draft:!1,editUrl:"https://github.com/bnb-chain/bnb-chain.github.io/blob/master/docs/learn/cross-chain.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_label:"Architecture",sidebar_position:2,hide_table_of_contents:!1},sidebar:"bscSideBar",previous:{title:"Parlia Consensus Engine",permalink:"/bnbchain-docsite/docs/learn/consensus"},next:{title:"Build-in System Contracts",permalink:"/bnbchain-docsite/docs/learn/system-contract"}},s={},l=[{value:"Architecture Diagram",id:"architecture-diagram",level:2},{value:"BC to BSC Architecture",id:"bc-to-bsc-architecture",level:2},{value:"BSC to BC Architecture",id:"bsc-to-bc-architecture",level:2},{value:"Timeout and Error Handling",id:"timeout-and-error-handling",level:2}],u={toc:l},d="wrapper";function h(e){let{components:t,...o}=e;return(0,r.kt)(d,(0,n.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"cross-chain-communication"},"Cross-Chain Communication"),(0,r.kt)("p",null,"Cross-chain communication is the key foundation to allow the community to take advantage of the dual chain structure:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Users are free to create any tokenization, financial products, and digital assets on BSC or BC as they wish."),(0,r.kt)("li",{parentName:"ul"},"The items on BSC can be manually and programmingly traded and circulated in a stable, high throughput, lighting fast and friendly environment of BC."),(0,r.kt)("li",{parentName:"ul"},"Users can operate these in one UI and tooling ecosystem.")),(0,r.kt)("h2",{id:"architecture-diagram"},"Architecture Diagram"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"img",src:a(34790).Z,width:"1960",height:"730"})),(0,r.kt)("p",null,"A native cross chain communication protocol is developed between BC (BNB Beacon Chain) and BSC (BNB Smart Chain). It has the following key parts:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/bnbchain-docsite/docs/learn/system-contract"},"Build-in System Contract")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/bnbchain-docsite/docs/learn/oracle-module"},"Oracle on BNB Beacon Chain")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/bnbchain-docsite/docs/learn/bsc-relayer"},"BSC Relayer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/bnbchain-docsite/docs/learn/incentives"},"BSC Relayer Incentive Mechanism")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/bnbchain-docsite/docs/learn/oracle-relayer"},"Oracle Relayer"))),(0,r.kt)("h2",{id:"bc-to-bsc-architecture"},"BC to BSC Architecture"),(0,r.kt)("p",null,"BC is a Tendermint-based, instant finality blockchain. Validators with at least \u2154","*","N+1 of the total voting power will co-sign each block on the chain. So that it is practical to verify the block transactions and even the state value via ",(0,r.kt)("strong",{parentName:"p"},"Block Header")," and ",(0,r.kt)("strong",{parentName:"p"},"Merkle Proof"),' verification. This has been researched and implemented as "',(0,r.kt)("strong",{parentName:"p"},"Light-Client Protocol"),'", which are intensively discussed in ',(0,r.kt)("a",{parentName:"p",href:"https://github.com/ethereum/wiki/wiki/Light-client-protocol"},"the Ethereum")," community, studied and implemented for ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cosmos/ics/blob/a4173c91560567bdb7cc9abee8e61256fc3725e9/spec/ics-007-tendermint-client/README.md"},"Cosmos inter-chain communication"),"."),(0,r.kt)("p",null,'BC-to-BSC communication will be verified in an "',(0,r.kt)("strong",{parentName:"p"},"on-chain light client"),'" implemented via BSC ',(0,r.kt)("strong",{parentName:"p"},"Smart Contracts")," (some of them may be ",(0,r.kt)("strong",{parentName:"p"},'"pre-compiled"'),'). After some transactions and state change happen on BC, if a transaction is defined to trigger cross-chain communication,the Cross-chain "',(0,r.kt)("strong",{parentName:"p"},"package"),'" message will be created and ',(0,r.kt)("strong",{parentName:"p"},"BSC Relayers"),' will pass and submit them onto BSC as data into the "build-in system contracts". The build-in system contracts will verify the package and execute the transactions if it passes the verification. The verification will be guaranteed with the below design:'),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"BC blocking status will be synced to the light client contracts on BSC from time to time, via block header and pre-commits, for the below information:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"block and app hash of BC that are signed by validators"),(0,r.kt)("li",{parentName:"ul"},"current validatorset, and validator set update"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"the key-value from the blockchain state will be verified based on the Merkle Proof and information from above #1."))),(0,r.kt)("p",null,"After confirming the key-value is accurate and trustful, the build-in system contracts will execute the actions corresponding to the cross-chain packages. Some examples of such packages that can be created for BC-to-BSC are:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Bind: bind the BEP2 tokens and BEP2E"),(0,r.kt)("li",{parentName:"ol"},"Transfer: transfer tokens after binding, this means the circulation will decrease (be locked) from BC and appear in the target address balance on BSC"),(0,r.kt)("li",{parentName:"ol"},"Error Handling: to handle any timeout/failure event for BSC-to-BC communication"),(0,r.kt)("li",{parentName:"ol"},"Validatorset update of BSC")),(0,r.kt)("p",null,'To ensure no duplication, proper message sequence and timely timeout, there is a "Channel" concept introduced on BC to manage any types of the communication.'),(0,r.kt)("p",null,'For relayers, please also refer to the below "Relayers" section.'),(0,r.kt)("h2",{id:"bsc-to-bc-architecture"},"BSC to BC Architecture"),(0,r.kt)("p",null,"BSC uses Proof of Staked Authority consensus protocol, which has a chance to fork and requires confirmation of more blocks. One block only has the signature of one validator, so that it is not easy to rely on one block to verify data from BSC."),(0,r.kt)("p",null,"To take full advantage of validator quorum of BC, an idea similar to many ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/poanetwork/poa-bridge"},"Bridge")," or Oracle blockchains is adopted:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The cross-chain communication requests from BSC will be submitted and executed onto BSC as transactions. The execution of the transaction wil emit ",(0,r.kt)("inlineCode",{parentName:"li"},"Events"),', and such events can be observed and packaged in certain "',(0,r.kt)("strong",{parentName:"li"},"Oracle"),'" onto BC. Instead of Block Headers, Hash and Merkle Proof, this type of "Oracle" package directly contains the cross-chain information for actions, such as sender, receiver and amount for transfer.'),(0,r.kt)("li",{parentName:"ol"},'To ensure the security of the Oracle, the validators of BC will form another quorum of "',(0,r.kt)("strong",{parentName:"li"},"Oracle Relayers"),'". Each validator of the BC should run a ',(0,r.kt)("strong",{parentName:"li"},"dedicated process")," as the Oracle Relayer. These Oracle Relayers will submit and  vote for the cross-chain communication package, like Oracle, onto BC,  using the same validator keys. Any package signed by more than \u2154","*","N+1 Oracle Relayers\u2019 voting power is as secure as any block signed by \u2154","*","N+1 of     the same quorum of validators\u2019 voting power.")),(0,r.kt)("p",null,"By using the same validator quorum, it saves the light client code on BC and continuous block updates onto BC. Such Oracles also have Oracle IDs and types, to ensure sequencing and proper error handling."),(0,r.kt)("h2",{id:"timeout-and-error-handling"},"Timeout and Error Handling"),(0,r.kt)("p",null,"There are scenarios that the cross-chain communication fails. For example, the relayed package cannot be executed on BSC due to some coding bug in the contracts. ",(0,r.kt)("strong",{parentName:"p"},"Timeout and error handling logics are")," used in such scenarios."),(0,r.kt)("p",null,"For the recognizable user and system errors or any expected exceptions, the two networks should heal themselves. For example, when BC to BSC transfer fails, BSC will issue a failure event and Oracle Relayers will execute a refund on BC; when BSC to BC transfer fails, BC will issue a refund package for Relayer to relay in order to unlock the fund."),(0,r.kt)("p",null,'However, unexpected error or exception may still happen on any step of the cross-chain communication. In such a case, the Relayers and Oracle Relayers will discover that the corresponding cross-chain channel is stuck in a particular sequence. After a Timeout period, the Relayers and Oracle Relayers can request a "SkipSequence" transaction, the stuck sequence will be marked as "Unexecutable". A corresponding alerts will be raised, and the community has to discuss how to handle this scenario, e.g. payback via the sponsor of the validators, or event clear the fund during next network upgrade.'))}h.isMDXComponent=!0},34790:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/cross-transfer-architecture-96420c26b3e1af1d5664120fb6a940a6.png"}}]);